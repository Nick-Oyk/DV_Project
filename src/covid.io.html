<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Question 2 Sparkline Chart</title>
    <style>
      .content {
        max-width: 500px;
        margin: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        padding-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="chart-wrapper" style="position: relative; margin-left: 20px">
      <div
        id="marker"
        style="
          position: absolute;
          z-index: 1;
          display: none;
          width: 1px;
          border-left: 1px solid black;
        "
      ></div>
      <div id="charts" style="float: left"></div>
      <div id="chart-lengends" style="float: left"></div>
    </div>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/flot/0.7/jquery.flot.min.js"></script>

    <script>
      $(function () {
        data = [
          {
            label: "Malaysia",
            data: [
              [1960, 0.155758351823196],
              [1961, 0.154708338465889],
              [1962, 0.15736247758304098],
              [1963, 0.17547656667521702],
              [1964, 0.201092708107488],
              [1965, 0.224424367302655],
              [1966, 0.250853905438728],
              [1967, 0.271937157699548],
              [1968, 0.29972272164425096],
              [1969, 0.345245125270376],
              [1970, 0.404076332139288],
              [1971, 0.448189313184516],
              [1972, 0.555899770509207],
              [1973, 0.732943121555639],
              [1974, 0.8446257577965429],
              [1975, 0.92471123440837],
              [1976, 1.01693953894779],
              [1977, 1.21205555652957],
              [1978, 1.52867990978479],
              [1979, 1.66090086317477],
              [1980, 1.7970442001228601],
              [1981, 1.98544470116573],
              [1982, 1.94171995168336],
              [1983, 2.0583072141578502],
              [1984, 2.20601162185217],
              [1985, 2.33743726546771],
              [1986, 3.0443225056739],
              [1987, 3.5579035197859303],
              [1988, 4.28276044965662],
              [1989, 4.48235048932469],
              [1990, 4.690184661696589],
              [1991, 5.28108228407632],
              [1992, 5.7623237053037],
              [1993, 6.45362199757356],
              [1994, 7.19724444570093],
              [1995, 8.1232964264891],
              [1996, 7.80979131929059],
              [1997, 7.5076873747512005],
              [1998, 6.70356675241045],
              [1999, 7.46611962451055],
              [2000, 8.07438034385162],
              [2001, 7.50768899577212],
              [2002, 7.62483790018704],
              [2003, 8.37990440855396],
              [2004, 9.39360115346774],
              [2005, 9.991964308423539],
              [2006, 10.594146717177301],
              [2007, 11.8554473545105],
              [2008, 13.6742820960544],
              [2009, 14.058906333763401],
              [2010, 16.3103027590767],
              [2011, 18.80024281251],
            ],
          },
          {
            label: "Singapore",
            data: [
              [1960, 0.442123789761523],
              [1961, 0.470625042294723],
              [1962, 0.514526712663984],
              [1963, 0.5673750409479831],
              [1964, 0.628323089574272],
              [1965, 0.6837343433635501],
              [1966, 0.742801533835998],
              [1967, 0.799189805253066],
              [1968, 0.833514526468225],
              [1969, 0.915211282101158],
              [1970, 0.997071615936847],
              [1971, 1.1236563816731102],
              [1972, 1.3471312339680601],
              [1973, 1.71159440705281],
              [1974, 1.9332046356886798],
              [1975, 2.2658386285940098],
              [1976, 2.3569912659096803],
              [1977, 2.67190283745206],
              [1978, 3.2561968919296898],
              [1979, 3.9772073423268903],
              [1980, 4.50067613837895],
              [1981, 4.00375560861233],
              [1982, 3.85961883811108],
              [1983, 3.7418081477691603],
              [1984, 3.5955483699749],
              [1985, 3.71983618846311],
              [1986, 5.04725161653157],
              [1987, 6.19475789463546],
              [1988, 6.88454810595434],
              [1989, 7.041961296771309],
              [1990, 8.567004006990361],
              [1991, 8.818893622221301],
              [1992, 9.45086684368378],
              [1993, 8.689515119252741],
              [1994, 9.10000526118154],
              [1995, 10.415187896762301],
              [1996, 10.6160233905887],
              [1997, 10.068795388689],
              [1998, 10.3154689771872],
              [1999, 10.202009273962199],
              [2000, 9.59305543654579],
              [2001, 9.69735893376965],
              [2002, 10.615147773523901],
              [2003, 12.950336729500199],
              [2004, 15.0999960796641],
              [2005, 16.0841434828981],
              [2006, 17.4095801825782],
              [2007, 20.3622644269488],
              [2008, 22.35945362792],
              [2009, 19.6446539546222],
              [2010, 20.0380870635273],
              [2011, 22.1459396328311],
            ],
          },
          {
            label: "United States",
            data: [
              [1960, 0.0810583157769874],
              [1961, 0.086039249513451],
              [1962, 0.09898911106657761],
              [1963, 0.0993330958816766],
              [1964, 0.11052782607136301],
              [1965, 0.118171223561332],
              [1966, 0.12974763243130902],
              [1967, 0.132916283275957],
              [1968, 0.143354817035995],
              [1969, 0.160244131325496],
              [1970, 0.174522985692565],
              [1971, 0.19504777922012398],
              [1972, 0.21936336364879902],
              [1973, 0.287545371609099],
              [1974, 0.37249623777013097],
              [1975, 0.39074897611883197],
              [1976, 0.43451945960377397],
              [1977, 0.478041498578193],
              [1978, 0.542613341499506],
              [1979, 0.645906819281006],
              [1980, 0.7688175429159251],
              [1981, 0.884636949015867],
              [1982, 0.828337327411261],
              [1983, 0.735072067887652],
              [1984, 0.725859673183313],
              [1985, 0.74647366583182],
              [1986, 0.760611990028521],
              [1987, 0.800975236180132],
              [1988, 0.909214325336314],
              [1989, 0.995013057222604],
              [1990, 1.15944793617358],
              [1991, 1.23136220660055],
              [1992, 1.3347002868484699],
              [1993, 1.4524700762704699],
              [1994, 1.7345289971112199],
              [1995, 1.82861238036786],
              [1996, 1.97315660752926],
              [1997, 2.15125895051574],
              [1998, 2.15795985749246],
              [1999, 1.93021642749839],
              [2000, 2.14286503964013],
              [2001, 2.08874204880004],
              [2002, 1.87617223589982],
              [2003, 2.0114139050788102],
              [2004, 2.31452328782426],
              [2005, 2.79322485324156],
              [2006, 3.27516601743138],
              [2007, 3.85594024590809],
              [2008, 4.47511240568074],
              [2009, 4.19082275122277],
              [2010, 5.1785301821609195],
              [2011, 5.80210091858771],
            ],
          },
        ];

        $.each(data, (index, region) => {
          var div = $("<div>").css({ width: "600px", height: "50px" });
          region.div = div;
          $("#charts").append(div);

          $.plot(region.div, [region.data], {
            series: { lines: { fill: true, lineWidth: 1 }, shadowSize: 0 },
            xaxis: {
              show: true,
              labelHeight: 0,
              min: 1960,
              max: 2011,
              tickFormatter: () => {
                return "";
              },
            },
            yaxis: { show: true, min: 0, max: 60 },
            grid: {
              show: true,
              margin: 0,
              borderWidth: 0,
              borderColor: null,
              labelMargin: 0,
              axisMargin: 0,
              minBorderMargin: 0,
              hoverable: true,
              autoHightlight: false,
            },
          });

          var legend = $("<p>").text(region.label).css({
            height: "17px",
            "margin-bottom": "0",
            "margin-left": "10px",
            "margin-top": "0",
            "padding-top": "33px",
          });
          $("#chart-legends").append(legend);
          var value = $("<div>").css({
            position: "absolute",
            top: div.position().top - 3 + "px",
            display: "none",
            "z-index": 1,
            "font-size": "11px",
            color: "black",
          });
          region.value = value;
          $("#chart-wrapper").append(value);
        });

        var dummy = [];
        for (var i = 1960; i < 2012; i++) {
          dummy.push([i, 0]);
        }
        var div = $("<div>").css({
          width: "600px",
          height: "15px",
        });
        $("#charts").append(div);
        var dummyPlot = $.plot(div, [dummy], {
          xaxis: { show: true, labelHeight: 12, min: 1960, max: 2011 },
          yaxis: { show: false, min: 100, max: 200 },
          grid: {
            show: true,
            margin: 0,
            borderWidth: 0,
            margin: 0,
            labelMargin: 0,
            axisMargin: 0,
            minBorderMargin: 0,
          },
        });
        $("#charts")
          .on("plothover", (event, pos) => {
            var year = Math.round(pos.x);
            var left = dummyPlot.pointOffset(pos).left;
            var height = $("#charts").height();
            $("#marker")
              .css({
                top: 0,
                left: left,
                width: "1px",
                height: height,
              })
              .show();
            $.each(data, (index, region) => {
              matched = $.grep(region.data, (pt) => {
                return pt[0] === year;
              });
              if (matched.length > 0) {
                region.value.text(
                  year + ": " + Math.round(matched[0][1]) + "%"
                );
              } else {
                region.value.text("");
              }
              region.value.css("left", left + 4 + "px").show();
            });
          })
          .on("mouseout", (ev) => {
            if (ev.relatedTarget.id !== "marker") {
              $("#marker").hide();
              $.each(data, (idx, region) => {
                region.value.hide();
              });
            }
          });
      });
    </script>
  </body>
</html>
